<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/projects"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalhes do Projeto</ion-title>
    <ion-buttons slot="end" *ngIf="canEdit">
      <ion-button (click)="openActionSheet()">
        <ion-icon slot="icon-only" name="ellipsisVertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="project">
  <div class="project-header" [style.background-color]="project.cor">
    <h1>{{ project.nome }}</h1>
    <ion-badge [color]="getStatusColor(project.status)">
      {{ getStatusLabel(project.status) }}
    </ion-badge>
  </div>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Descrição</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ project.descricao || 'Sem descrição' }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="list"></ion-icon>
        Tarefas ({{ totalTasksCount }})
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-progress-bar [value]="projectProgress"></ion-progress-bar>
      <p class="progress-text">
        {{ completedTasksCount }} de {{ totalTasksCount }} concluídas
        ({{ (projectProgress * 100).toFixed(0) }}%)
      </p>

      <div class="task-buttons">
        <ion-button expand="block" (click)="createTask()">
          <ion-icon slot="start" name="add"></ion-icon>
          Criar Nova Tarefa
        </ion-button>
        <ion-button expand="block" fill="outline" (click)="viewProjectTasks()">
          <ion-icon slot="start" name="list"></ion-icon>
          Ver Todas as Tarefas
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="calendar"></ion-icon>
        Informações
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item>
          <ion-label>
            <p>Criado em</p>
            <h3>{{ formatDate(project.dataCriacao) }}</h3>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <p>Última atualização</p>
            <h3>{{ formatDate(project.dataAtualizacao) }}</h3>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
</ion-content>

<ion-content *ngIf="!project">
  <div class="empty-state">
    <ion-icon name="archive"></ion-icon>
    <h2>Projeto não encontrado</h2>
    <p>O projeto que você está procurando não existe ou foi removido.</p>
    <ion-button routerLink="/tabs/projects">
      Voltar para Projetos
    </ion-button>
  </div>
</ion-content>

<ion-action-sheet
  [isOpen]="isActionSheetOpen"
  (didDismiss)="isActionSheetOpen = false"
  header="Ações do Projeto"
  [buttons]="actionSheetButtons"
>
</ion-action-sheet>
