import{a as ht,b as Dt}from"./chunk-ENFGIFJN.js";import{a as mt,b as Et,c as ut,d as St}from"./chunk-NYAYANX7.js";import{E as pt,X as gt,Z as Tt,a as ot,b as vt,c as it,d as rt,e as at,g as ct,k as st,s as lt,x as dt}from"./chunk-DC72OUVS.js";import{d as k,f as kt,g as m,h as xt,y as nt,z as It}from"./chunk-W6BZYZPR.js";import"./chunk-NRZIFRM7.js";import{A as p,Bb as L,C as x,Cb as z,Da as D,Db as B,Eb as q,F as b,Fa as w,Fb as F,Gb as H,Hb as N,J as u,K as n,Ka as Ot,Kb as R,L as o,M as g,Pb as U,Q as O,Qb as W,R as h,S as P,Ub as $,Vb as G,Yb as J,_ as I,aa as r,ab as y,ba as f,ca as M,cb as Mt,da as v,fc as K,gc as Q,ic as X,lc as Y,mc as Z,na as bt,oc as tt,qa as T,r as j,s as C,ta as E,ua as S,ub as A,uc as et,yb as V,z as a}from"./chunk-MUBZYPCN.js";import"./chunk-IUOEA5VS.js";import"./chunk-GG6GQ6ON.js";import"./chunk-HKEYXBPG.js";import"./chunk-65VMTP75.js";import"./chunk-DKYB3LAM.js";import"./chunk-WKMV7HP7.js";import"./chunk-2CQGC6XC.js";import"./chunk-MOTUYE2F.js";import"./chunk-7BGE4CD4.js";import"./chunk-Z3ZIDQ56.js";import"./chunk-TRVT55KM.js";import"./chunk-NLP2MHHW.js";import"./chunk-KFF2YPXM.js";import"./chunk-VX62UQSI.js";import"./chunk-5R267MUJ.js";import{f as _t,h as d}from"./chunk-ECACSZ36.js";function wt(c,l){if(c&1){let i=O();n(0,"ion-buttons",5)(1,"ion-button",6),h("click",function(){j(i);let e=P();return C(e.openActionSheet())}),g(2,"ion-icon",7),o()()}}function yt(c,l){if(c&1){let i=O();n(0,"ion-content")(1,"div",8)(2,"h1"),r(3),o(),n(4,"ion-badge",9),r(5),o()(),n(6,"ion-card")(7,"ion-card-header")(8,"ion-card-title"),r(9,"Descri\xE7\xE3o"),o()(),n(10,"ion-card-content")(11,"p"),r(12),o()()(),n(13,"ion-card")(14,"ion-card-header")(15,"ion-card-title"),g(16,"ion-icon",10),r(17),o()(),n(18,"ion-card-content"),g(19,"ion-progress-bar",11),n(20,"p",12),r(21),o(),n(22,"div",13)(23,"ion-button",14),h("click",function(){j(i);let e=P();return C(e.createTask())}),g(24,"ion-icon",15),r(25," Criar Nova Tarefa "),o(),n(26,"ion-button",16),h("click",function(){j(i);let e=P();return C(e.viewProjectTasks())}),g(27,"ion-icon",17),r(28," Ver Todas as Tarefas "),o()()()(),n(29,"ion-card")(30,"ion-card-header")(31,"ion-card-title"),g(32,"ion-icon",18),r(33," Informa\xE7\xF5es "),o()(),n(34,"ion-card-content")(35,"ion-list")(36,"ion-item")(37,"ion-label")(38,"p"),r(39,"Criado em"),o(),n(40,"h3"),r(41),o()()(),n(42,"ion-item")(43,"ion-label")(44,"p"),r(45,"\xDAltima atualiza\xE7\xE3o"),o(),n(46,"h3"),r(47),o()()()()()()()}if(c&2){let i=P();a(),I("background-color",i.project.cor),a(2),f(i.project.nome),a(),u("color",i.getStatusColor(i.project.status)),a(),M(" ",i.getStatusLabel(i.project.status)," "),a(7),f(i.project.descricao||"Sem descri\xE7\xE3o"),a(5),M(" Tarefas (",i.totalTasksCount,") "),a(2),u("value",i.projectProgress),a(2),v(" ",i.completedTasksCount," de ",i.totalTasksCount," conclu\xEDdas (",(i.projectProgress*100).toFixed(0),"%) "),a(20),f(i.formatDate(i.project.dataCriacao)),a(6),f(i.formatDate(i.project.dataAtualizacao))}}function At(c,l){c&1&&(n(0,"ion-content")(1,"div",19),g(2,"ion-icon",20),n(3,"h2"),r(4,"Projeto n\xE3o encontrado"),o(),n(5,"p"),r(6,"O projeto que voc\xEA est\xE1 procurando n\xE3o existe ou foi removido."),o(),n(7,"ion-button",21),r(8," Voltar para Projetos "),o()()())}var Xt,Vt=_t(()=>{S();Mt();et();vt();Tt();xt();kt();Dt();bt();Ot();Et();It();St();et();S();Xt=(()=>{let l=class l{constructor(t,e,s,_,Pt,ft,jt,Ct){this.route=t,this.router=e,this.projectService=s,this.authService=_,this.taskService=Pt,this.modalCtrl=ft,this.alertCtrl=jt,this.toastCtrl=Ct,this.isActionSheetOpen=!1,this.projectTasks=[],this.actionSheetButtons=[{text:"Editar",icon:"create",handler:()=>{this.openEditModal()}},{text:"Marcar como Conclu\xEDdo",icon:"checkmarkCircle",handler:()=>{this.completeProject()}},{text:"Arquivar",icon:"archive",handler:()=>{this.archiveProject()}},{text:"Excluir",role:"destructive",icon:"trash",handler:()=>{this.confirmDelete()}},{text:"Cancelar",role:"cancel"}],ot({arrowBack:at,create:lt,trash:gt,archive:rt,checkmarkCircle:st,list:pt,calendar:ct,ellipsisVertical:dt,add:it})}ngOnInit(){this.projectId=this.route.snapshot.paramMap.get("id")||void 0,this.currentUserId=this.authService.getCurrentUserId()||void 0,this.loadProject(),this.subscribeToTaskUpdates()}ionViewWillEnter(){console.log("[ProjectDetailPage] ionViewWillEnter - reloading tasks"),this.loadProjectTasks()}ngOnDestroy(){this.tasksSubscription&&this.tasksSubscription.unsubscribe()}subscribeToTaskUpdates(){this.tasksSubscription=this.taskService.tasks$.subscribe(t=>{console.log("[ProjectDetailPage] Tasks updated via subscription:",t.length),this.filterProjectTasks(t)})}filterProjectTasks(t){if(!this.projectId){this.projectTasks=[];return}this.projectTasks=t.filter(e=>(console.log(`[ProjectDetailPage] Task ${e.id} projectId:`,e.projectId,"matches:",e.projectId===this.projectId),e.projectId===this.projectId)),console.log("[ProjectDetailPage] Filtered project tasks:",this.projectTasks.length)}loadProject(){return d(this,null,function*(){this.projectId&&(this.project=this.projectService.getProjectById(this.projectId),yield this.loadProjectTasks())})}loadProjectTasks(){return d(this,null,function*(){if(!this.projectId){console.log("[ProjectDetailPage] No projectId, skipping task load");return}try{console.log("[ProjectDetailPage] Loading tasks for project:",this.projectId);let t=yield this.taskService.getTasks();console.log("[ProjectDetailPage] Total tasks in system:",t.length),console.log("[ProjectDetailPage] All tasks:",t),this.filterProjectTasks(t),console.log("[ProjectDetailPage] Project tasks:",this.projectTasks)}catch(t){console.error("[ProjectDetailPage] Error loading tasks:",t),this.projectTasks=[]}})}get isOwner(){return this.project?.ownerId===this.currentUserId}get canEdit(){return this.isOwner}get projectProgress(){return!this.projectTasks||this.projectTasks.length===0?0:this.projectTasks.filter(e=>e.status===k.COMPLETED).length/this.projectTasks.length}get completedTasksCount(){return this.projectTasks.filter(t=>t.status===k.COMPLETED).length}get totalTasksCount(){return this.projectTasks.length}getStatusColor(t){return{[m.ACTIVE]:"success",[m.ON_HOLD]:"warning",[m.COMPLETED]:"primary",[m.ARCHIVED]:"medium"}[t]||"medium"}getStatusLabel(t){return{[m.ACTIVE]:"Ativo",[m.ON_HOLD]:"Em Pausa",[m.COMPLETED]:"Conclu\xEDdo",[m.ARCHIVED]:"Arquivado"}[t]||t}formatDate(t){return t?new Date(t).toLocaleDateString("pt-BR"):"N/A"}openEditModal(){return d(this,null,function*(){let t=yield this.modalCtrl.create({component:ht,componentProps:{project:this.project},backdropDismiss:!1});yield t.present();let{data:e,role:s}=yield t.onWillDismiss();s==="confirm"&&e&&this.projectId&&(yield this.projectService.updateProject(this.projectId,e))&&(this.loadProject(),this.showToast("Projeto atualizado com sucesso!"))})}confirmDelete(){return d(this,null,function*(){yield(yield this.alertCtrl.create({header:"Confirmar Exclus\xE3o",message:"Tem certeza que deseja excluir este projeto? Esta a\xE7\xE3o n\xE3o pode ser desfeita.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Excluir",role:"destructive",handler:()=>{this.deleteProject()}}]})).present()})}deleteProject(){return d(this,null,function*(){if(!this.projectId)return;(yield this.projectService.deleteProject(this.projectId))&&(this.showToast("Projeto exclu\xEDdo com sucesso!"),this.router.navigate(["/tabs/projects"]))})}archiveProject(){return d(this,null,function*(){if(!this.projectId)return;(yield this.projectService.archiveProject(this.projectId))&&(this.loadProject(),this.showToast("Projeto arquivado!"))})}completeProject(){return d(this,null,function*(){if(!this.projectId)return;(yield this.projectService.completeProject(this.projectId))&&(this.loadProject(),this.showToast("Projeto marcado como conclu\xEDdo!"))})}openActionSheet(){this.isActionSheetOpen=!0}createTask(){console.log("[ProjectDetailPage] Creating task for project:",this.projectId),this.router.navigate(["/task-form"],{queryParams:{projectId:this.projectId}})}viewProjectTasks(){console.log("[ProjectDetailPage] Viewing tasks for project:",this.projectId),this.router.navigate(["/tabs/tasks"],{queryParams:{projectId:this.projectId}})}showToast(t){return d(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2e3,position:"bottom"})).present()})}};l.\u0275fac=function(e){return new(e||l)(p(D),p(w),p(mt),p(nt),p(ut),p(X),p(Y),p(Z))},l.\u0275cmp=x({type:l,selectors:[["app-project-detail"]],decls:10,vars:5,consts:[["slot","start"],["defaultHref","/tabs/projects"],["slot","end",4,"ngIf"],[4,"ngIf"],["header","A\xE7\xF5es do Projeto",3,"didDismiss","isOpen","buttons"],["slot","end"],[3,"click"],["slot","icon-only","name","ellipsisVertical"],[1,"project-header"],[3,"color"],["name","list"],[3,"value"],[1,"progress-text"],[1,"task-buttons"],["expand","block",3,"click"],["slot","start","name","add"],["expand","block","fill","outline",3,"click"],["slot","start","name","list"],["name","calendar"],[1,"empty-state"],["name","archive"],["routerLink","/tabs/projects"]],template:function(e,s){e&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),g(3,"ion-back-button",1),o(),n(4,"ion-title"),r(5,"Detalhes do Projeto"),o(),b(6,wt,3,0,"ion-buttons",2),o()(),b(7,yt,48,13,"ion-content",3)(8,At,9,0,"ion-content",3),n(9,"ion-action-sheet",4),h("didDismiss",function(){return s.isActionSheetOpen=!1}),o()),e&2&&(a(6),u("ngIf",s.canEdit),a(),u("ngIf",s.project),a(),u("ngIf",!s.project),a(),u("isOpen",s.isActionSheetOpen)("buttons",s.actionSheetButtons))},dependencies:[E,T,y,U,Q,K,R,B,A,z,tt,q,H,N,F,G,W,$,L,J,V],styles:['ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%)}.project-header[_ngcontent-%COMP%]{padding:32px 24px;text-align:center;color:#fff;position:relative;overflow:hidden}.project-header[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:#0003}.project-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 12px;font-size:28px;font-weight:700;position:relative;z-index:1}.project-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{position:relative;z-index:1}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:16px;background:#ffffff0d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#fff}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{color:#fffc}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;line-height:1.6}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{margin-top:8px;font-size:14px;text-align:center;color:#fff9}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:16px}ion-list[_ngcontent-%COMP%]{background:transparent}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--border-color: rgba(255, 255, 255, .1)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-weight:500}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff9}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{--background: rgba(102, 126, 234, .2);--color: #667eea;font-size:12px;font-weight:600}ion-progress-bar[_ngcontent-%COMP%]{height:8px;border-radius:4px;--background: rgba(255, 255, 255, .1);--progress-background: linear-gradient(90deg, #667eea 0%, #764ba2 100%)}.task-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:16px}.task-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 12px;height:44px;font-weight:600}.task-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:not([fill=outline]){--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:32px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:120px;color:#fff3;margin-bottom:24px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff;margin:0 0 12px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff9;margin:0 0 24px}.empty-state[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}@media (prefers-color-scheme: light){ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)}.project-header[_ngcontent-%COMP%]:before{background:#0000001a}ion-card[_ngcontent-%COMP%]{background:#ffffffe6;border:1px solid rgba(0,0,0,.1)}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:#000}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{color:#000c}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{color:#0009}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--border-color: rgba(0, 0, 0, .1)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#000}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#0009}ion-progress-bar[_ngcontent-%COMP%]{--background: rgba(0, 0, 0, .1)}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#0003}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#000}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#0009}}']});let c=l;return c})()});Vt();export{Xt as ProjectDetailPage};
